{"version":3,"file":"handler-modal-Fp6B2RfH.js","sources":["../../src/handlers/handler-modal.js"],"sourcesContent":["// Store event listener references for cleanup\nlet formSubmitListener = null;\nlet exerciseModalClickListener = null;\nlet ratingModalClickListener = null;\nlet documentKeydownListener = null;\nlet ratingChangeListeners = [];\n\n// Store current exercise ID for rating submission\nlet currentExerciseId = null;\n\n/**\n * Initialize the modal handlers\n * This function attaches all event listeners for modals\n */\nexport function initModalHandler() {\n  // Query DOM elements\n  const exerciseModal = document.querySelector('.exercise-modal');\n  const ratingModal = document.querySelector('.rating-modal');\n  const form = document.querySelector('.form-rating');\n  const ratingForm = document.querySelector('.form-rating');\n\n  // Remove old event listeners if they exist\n  if (formSubmitListener && form) {\n    form.removeEventListener('submit', formSubmitListener);\n  }\n  if (exerciseModalClickListener && exerciseModal) {\n    exerciseModal.removeEventListener('click', exerciseModalClickListener);\n  }\n  if (ratingModalClickListener && ratingModal) {\n    ratingModal.removeEventListener('click', ratingModalClickListener);\n  }\n  if (documentKeydownListener) {\n    document.removeEventListener('keydown', documentKeydownListener);\n  }\n  // Remove old rating change listeners\n  ratingChangeListeners.forEach(({ input, listener }) => {\n    input.removeEventListener('change', listener);\n  });\n  ratingChangeListeners = [];\n\n  // Attach form submit listener\n  formSubmitListener = async event => {\n    event.preventDefault();\n    const emailInput = document.querySelector('.form-input');\n    const commentInput = document.querySelector('.form-textarea');\n    const ratingInput = document.querySelector('input[name=\"rating\"]:checked');\n\n    const email = emailInput.value.trim();\n    const comment = commentInput.value.trim();\n    const rating = ratingInput ? ratingInput.value : null;\n\n    // Validate rating is selected\n    if (!rating) {\n      alert('Please select a rating');\n      return;\n    }\n\n    try {\n      // Send POST request to rating API\n      const response = await fetch(\n        `https://your-energy.b.goit.study/api/exercises/${currentExerciseId}/rating`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            rating: parseInt(rating),\n            email: email,\n            review: comment,\n          }),\n        }\n      );\n\n      if (response.ok) {\n        console.log('Rating submitted successfully');\n        ratingForm.reset();\n        // Reset rating count display\n        if (ratingCount) {\n          ratingCount.textContent = '0.0';\n        }\n        ratingModal.classList.remove('is-active');\n      } else {\n        console.error('Failed to submit rating:', response.status);\n        alert('Failed to submit rating. Please try again.');\n      }\n    } catch (error) {\n      console.error('Error submitting rating:', error);\n      alert('An error occurred. Please try again.');\n    }\n  };\n  if (form) {\n    form.addEventListener('submit', formSubmitListener);\n  }\n\n  // Attach rating change listeners to update rating count display\n  const ratingInputs = document.querySelectorAll('input[name=\"rating\"]');\n  const ratingCount = document.getElementById('rating-count');\n\n  ratingInputs.forEach(input => {\n    const changeListener = () => {\n      if (ratingCount) {\n        ratingCount.textContent = `${input.value}.0`;\n      }\n    };\n    input.addEventListener('change', changeListener);\n    ratingChangeListeners.push({ input, listener: changeListener });\n  });\n\n  // Attach exercise modal click listener\n  exerciseModalClickListener = event => {\n    if (event.target.closest('.exercise-modal_close')) {\n      exerciseModal.classList.remove('is-active');\n    }\n    if (event.target.closest('.modal-rating_btn')) {\n      // Store the exercise ID before opening rating modal\n      const modalContent = document.querySelector('.exercise-modal_content');\n      const favoriteBtn = modalContent.querySelector('.modal-favorites_btn');\n      currentExerciseId = favoriteBtn ? favoriteBtn.id : null;\n\n      // Reset rating count when modal opens\n      if (ratingCount) {\n        ratingCount.textContent = '0.0';\n      }\n\n      exerciseModal.classList.remove('is-active');\n      setTimeout(() => {\n        ratingModal.classList.add('is-active');\n      }, 250);\n    }\n    if (event.target === exerciseModal) {\n      exerciseModal.classList.remove('is-active');\n    }\n  };\n  if (exerciseModal) {\n    exerciseModal.addEventListener('click', exerciseModalClickListener);\n  }\n\n  // Attach rating modal click listener\n  ratingModalClickListener = event => {\n    if (\n      event.target.closest('.rating-modal_close') ||\n      event.target === ratingModal\n    ) {\n      ratingModal.classList.remove('is-active');\n      currentExerciseId = null; // Reset exercise ID\n      // Reset rating count display\n      if (ratingCount) {\n        ratingCount.textContent = '0.0';\n      }\n    }\n  };\n  if (ratingModal) {\n    ratingModal.addEventListener('click', ratingModalClickListener);\n  }\n\n  // Attach document keydown listener\n  documentKeydownListener = e => {\n    if (e.key === 'Escape') {\n      exerciseModal?.classList.remove('is-active');\n      ratingModal?.classList.remove('is-active');\n      currentExerciseId = null;\n      // Reset rating count display\n      if (ratingCount) {\n        ratingCount.textContent = '0.0';\n      }\n    }\n  };\n  document.addEventListener('keydown', documentKeydownListener);\n}\n"],"names":["formSubmitListener","exerciseModalClickListener","ratingModalClickListener","documentKeydownListener","ratingChangeListeners","currentExerciseId","initModalHandler","exerciseModal","ratingModal","form","ratingForm","input","listener","event","emailInput","commentInput","ratingInput","email","comment","rating","response","ratingCount","error","ratingInputs","changeListener","favoriteBtn"],"mappings":"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"}