import{o as E}from"./modal-utils-Bx-Stgcn.js";let c=null,u=null,m=null,d=null,g=[],o=null;function S(){const t=document.querySelector(".exercise-modal"),n=document.querySelector(".rating-modal"),s=document.querySelector(".form-rating"),i=document.getElementById("rating-count");c&&s&&s.removeEventListener("submit",c),u&&t&&t.removeEventListener("click",u),m&&n&&n.removeEventListener("click",m),d&&document.removeEventListener("keydown",d),g.forEach(({input:e,listener:r})=>{e.removeEventListener("change",r)}),g=[],c=async e=>{e.preventDefault();const r=document.querySelector(".form-input"),l=document.querySelector(".form-textarea"),v=document.querySelector('input[name="rating"]:checked'),y=r.value.trim(),L=l.value.trim(),f=v?v.value:null,p=Number(f);if(!f){alert("Please select a rating");return}try{const a=await fetch(`https://your-energy.b.goit.study/api/exercises/${o}/rating`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({rate:p,email:y,review:L})});if(a.ok)s.reset(),alert("Rating submitted successfully"),i&&(i.textContent="0.0"),n.classList.remove("is-active");else{if(a.status===409){r.value="",alert("Such email already exists");return}console.error("Failed to submit rating:",a.status),alert("Failed to submit rating. Please try again.")}}catch(a){a.message==="Such email already exists"&&(r.value="",alert("Such email already exists")),console.error("Error submitting rating:",a),alert("An error occurred. Please try again.")}},s&&s.addEventListener("submit",c),document.querySelectorAll('input[name="rating"]').forEach(e=>{const r=()=>{i&&(i.textContent=`${e.value}.0`)};e.addEventListener("change",r),g.push({input:e,listener:r})}),u=e=>{if(e.target.closest(".exercise-modal_close")&&t.classList.remove("is-active"),e.target.closest(".modal-rating_btn")){const l=document.querySelector(".exercise-modal_content").querySelector(".modal-favorites_btn");o=l?l.id:null,s.reset(),i&&(i.textContent="0.0"),t.classList.remove("is-active"),setTimeout(()=>{n.classList.add("is-active")},250)}e.target===t&&t.classList.remove("is-active")},t&&t.addEventListener("click",u),m=e=>{if(e.target.closest(".rating-modal_close")||e.target===n){s.reset(),n.classList.remove("is-active"),i&&(i.textContent="0.0");let r=o;o=null,setTimeout(()=>{E(r)},250)}},n&&n.addEventListener("click",m),d=e=>{e.key==="Escape"&&(console.log("[DEBUG] Escape key pressed"),s.reset(),t==null||t.classList.remove("is-active"),n==null||n.classList.remove("is-active"),o=null,i&&(i.textContent="0.0"))},document.addEventListener("keydown",d)}export{S as initModalHandler};
//# sourceMappingURL=handler-modal-CDhVDQgn.js.map
