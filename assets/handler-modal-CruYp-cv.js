import{o as E}from"./modal-utils-BWLxLC2h.js";let l=null,u=null,m=null,d=null,g=[],s=null;function C(){const t=document.querySelector(".exercise-modal"),n=document.querySelector(".rating-modal"),o=document.querySelector(".form-rating"),r=document.getElementById("rating-count");l&&o&&o.removeEventListener("submit",l),u&&t&&t.removeEventListener("click",u),m&&n&&n.removeEventListener("click",m),d&&document.removeEventListener("keydown",d),g.forEach(({input:e,listener:i})=>{e.removeEventListener("change",i)}),g=[],l=async e=>{e.preventDefault();const i=document.querySelector(".form-input"),a=document.querySelector(".form-textarea"),v=document.querySelector('input[name="rating"]:checked'),L=i.value.trim(),p=a.value.trim(),f=v?v.value:null,y=Number(f);if(console.log(typeof y),!f){alert("Please select a rating");return}try{const c=await fetch(`https://your-energy.b.goit.study/api/exercises/${s}/rating`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({rate:y,email:L,review:p})});c.ok?(o.reset(),alert("Rating submitted successfully"),r&&(r.textContent="0.0"),n.classList.remove("is-active")):(console.error("Failed to submit rating:",c.status),alert("Failed to submit rating. Please try again."))}catch(c){console.error("Error submitting rating:",c),alert("An error occurred. Please try again.")}},o&&o.addEventListener("submit",l),document.querySelectorAll('input[name="rating"]').forEach(e=>{const i=()=>{r&&(r.textContent=`${e.value}.0`)};e.addEventListener("change",i),g.push({input:e,listener:i})}),u=e=>{if(e.target.closest(".exercise-modal_close")&&t.classList.remove("is-active"),e.target.closest(".modal-rating_btn")){const a=document.querySelector(".exercise-modal_content").querySelector(".modal-favorites_btn");s=a?a.id:null,o.reset(),r&&(r.textContent="0.0"),t.classList.remove("is-active"),setTimeout(()=>{n.classList.add("is-active")},250)}e.target===t&&t.classList.remove("is-active")},t&&t.addEventListener("click",u),m=e=>{if(e.target.closest(".rating-modal_close")||e.target===n){o.reset(),n.classList.remove("is-active"),r&&(r.textContent="0.0");let i=s;s=null,setTimeout(()=>{E(i)},250)}},n&&n.addEventListener("click",m),d=e=>{e.key==="Escape"&&(console.log("[DEBUG] Escape key pressed"),o.reset(),t==null||t.classList.remove("is-active"),n==null||n.classList.remove("is-active"),s=null,r&&(r.textContent="0.0"))},document.addEventListener("keydown",d)}export{C as initModalHandler};
//# sourceMappingURL=handler-modal-CruYp-cv.js.map
