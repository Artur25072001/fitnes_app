import{o as S}from"./modal-utils-DXDv482n.js";let d=null,g=null,v=null,f=null,y=[],u=null;function b(){const n=document.querySelector(".exercise-modal"),l=document.querySelector(".rating-modal"),a=document.querySelector(".form-rating"),s=document.getElementById("rating-count");d&&a&&a.removeEventListener("submit",d),g&&n&&n.removeEventListener("click",g),v&&l&&l.removeEventListener("click",v),f&&document.removeEventListener("keydown",f),y.forEach(({input:r,listener:t})=>{r.removeEventListener("change",t)}),y=[],d=async r=>{r.preventDefault();const t=document.querySelector(".form-input"),o=document.querySelector(".form-textarea"),e=document.querySelector('input[name="rating"]:checked');console.log("[DEBUG] Form submit - ratingCount:",s),console.log("[DEBUG] Form submit - emailInput.value:",t==null?void 0:t.value),console.log("[DEBUG] Form submit - commentInput.value:",o==null?void 0:o.value),console.log("[DEBUG] Form submit - ratingInput.value:",e==null?void 0:e.value);const c=t.value.trim(),i=o.value.trim(),E=e?e.value:null,L=Number(E);if(console.log(typeof L),!E){alert("Please select a rating");return}try{const m=await fetch(`https://your-energy.b.goit.study/api/exercises/${u}/rating`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({rate:L,email:c,review:i})});m.ok?(console.log("Rating submitted successfully"),a.reset(),alert("Rating submitted successfully"),s&&(s.textContent="0.0"),l.classList.remove("is-active")):(console.error("Failed to submit rating:",m.status),alert("Failed to submit rating. Please try again."))}catch(m){console.error("Error submitting rating:",m),alert("An error occurred. Please try again.")}},a&&a.addEventListener("submit",d),document.querySelectorAll('input[name="rating"]').forEach(r=>{const t=()=>{s&&(s.textContent=`${r.value}.0`)};r.addEventListener("change",t),y.push({input:r,listener:t})}),g=r=>{if(r.target.closest(".exercise-modal_close")&&n.classList.remove("is-active"),r.target.closest(".modal-rating_btn")){const o=document.querySelector(".exercise-modal_content").querySelector(".modal-favorites_btn");u=o?o.id:null,console.log("[DEBUG] Opening rating modal - currentExerciseId:",u),a.reset(),s&&(s.textContent="0.0");const e=document.querySelector(".form-input"),c=document.querySelector(".form-textarea"),i=document.querySelector('input[name="rating"]:checked');console.log("[DEBUG] Before opening rating modal - email:",e==null?void 0:e.value,"comment:",c==null?void 0:c.value,"rating:",i==null?void 0:i.value),n.classList.remove("is-active"),setTimeout(()=>{l.classList.add("is-active"),console.log("[DEBUG] After opening rating modal - email:",e==null?void 0:e.value,"comment:",c==null?void 0:c.value,"rating:",i==null?void 0:i.value)},250)}r.target===n&&n.classList.remove("is-active")},n&&n.addEventListener("click",g),v=r=>{if(r.target.closest(".rating-modal_close")||r.target===l){console.log("[DEBUG] Closing rating modal - currentExerciseId:",u);const t=document.querySelector(".form-input"),o=document.querySelector(".form-textarea"),e=document.querySelector('input[name="rating"]:checked');console.log("[DEBUG] Before closing rating modal - email:",t==null?void 0:t.value,"comment:",o==null?void 0:o.value,"rating:",e==null?void 0:e.value),a.reset(),l.classList.remove("is-active"),s&&(s.textContent="0.0");let c=u;u=null,setTimeout(()=>{S(c),console.log("[DEBUG] After closing rating modal - email:",t==null?void 0:t.value,"comment:",o==null?void 0:o.value,"rating:",e==null?void 0:e.value)},250)}},l&&l.addEventListener("click",v),f=r=>{if(r.key==="Escape"){console.log("[DEBUG] Escape key pressed");const t=document.querySelector(".form-input"),o=document.querySelector(".form-textarea"),e=document.querySelector('input[name="rating"]:checked');console.log("[DEBUG] Escape - email:",t==null?void 0:t.value,"comment:",o==null?void 0:o.value,"rating:",e==null?void 0:e.value),a.reset(),n==null||n.classList.remove("is-active"),l==null||l.classList.remove("is-active"),u=null,s&&(s.textContent="0.0"),console.log("[DEBUG] Escape after - email:",t==null?void 0:t.value,"comment:",o==null?void 0:o.value,"rating:",e==null?void 0:e.value)}},document.addEventListener("keydown",f)}export{b as initModalHandler};
//# sourceMappingURL=handler-modal-DPUfmqEh.js.map
