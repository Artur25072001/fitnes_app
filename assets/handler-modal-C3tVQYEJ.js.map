{"version":3,"file":"handler-modal-C3tVQYEJ.js","sources":["../../src/handlers/handler-modal.js"],"sourcesContent":["import { openExerciseModal } from '../service/modal-utils';\n\n// Store event listener references for cleanup\nlet formSubmitListener = null;\nlet exerciseModalClickListener = null;\nlet ratingModalClickListener = null;\nlet documentKeydownListener = null;\nlet ratingChangeListeners = [];\n\n// Store current exercise ID for rating submission\nlet currentExerciseId = null;\n\n/**\n * Initialize the modal handlers\n * This function attaches all event listeners for modals\n */\nexport function initModalHandler() {\n  // Query DOM elements\n  const exerciseModal = document.querySelector('.exercise-modal');\n  const ratingModal = document.querySelector('.rating-modal');\n  const ratingForm = document.querySelector('.form-rating');\n  const ratingCount = document.getElementById('rating-count');\n\n  // Remove old event listeners if they exist\n  if (formSubmitListener && ratingForm) {\n    ratingForm.removeEventListener('submit', formSubmitListener);\n  }\n  if (exerciseModalClickListener && exerciseModal) {\n    exerciseModal.removeEventListener('click', exerciseModalClickListener);\n  }\n  if (ratingModalClickListener && ratingModal) {\n    ratingModal.removeEventListener('click', ratingModalClickListener);\n  }\n  if (documentKeydownListener) {\n    document.removeEventListener('keydown', documentKeydownListener);\n  }\n  // Remove old rating change listeners\n  ratingChangeListeners.forEach(({ input, listener }) => {\n    input.removeEventListener('change', listener);\n  });\n  ratingChangeListeners = [];\n\n  // Attach form submit listener\n  formSubmitListener = async event => {\n    event.preventDefault();\n    const emailInput = document.querySelector('.form-input');\n    const commentInput = document.querySelector('.form-textarea');\n    const ratingInput = document.querySelector('input[name=\"rating\"]:checked');\n\n    console.log('[DEBUG] Form submit - ratingCount:', ratingCount);\n    console.log('[DEBUG] Form submit - emailInput.value:', emailInput?.value);\n    console.log(\n      '[DEBUG] Form submit - commentInput.value:',\n      commentInput?.value\n    );\n    console.log('[DEBUG] Form submit - ratingInput.value:', ratingInput?.value);\n\n    const email = emailInput.value.trim();\n    const review = commentInput.value.trim();\n    const rating = ratingInput ? ratingInput.value : null;\n    const rate = Number(rating);\n    console.log(typeof rate);\n\n    // Validate rating is selected\n    if (!rating) {\n      alert('Please select a rating');\n      return;\n    }\n\n    try {\n      // Send POST request to rating API\n      const response = await fetch(\n        `https://your-energy.b.goit.study/api/exercises/${currentExerciseId}/rating`,\n        {\n          method: 'PATCH',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ rate, email, review }),\n        }\n      );\n\n      if (response.ok) {\n        console.log('Rating submitted successfully');\n        ratingForm.reset();\n        alert('Rating submitted successfully');\n        // Reset rating count display\n        if (ratingCount) {\n          ratingCount.textContent = '0.0';\n        }\n        ratingModal.classList.remove('is-active');\n      } else {\n        console.error('Failed to submit rating:', response.status);\n        alert('Failed to submit rating. Please try again.');\n      }\n    } catch (error) {\n      console.error('Error submitting rating:', error);\n      alert('An error occurred. Please try again.');\n    }\n  };\n  if (ratingForm) {\n    ratingForm.addEventListener('submit', formSubmitListener);\n  }\n\n  // Attach rating change listeners to update rating count display\n  const ratingInputs = document.querySelectorAll('input[name=\"rating\"]');\n\n  ratingInputs.forEach(input => {\n    const changeListener = () => {\n      if (ratingCount) {\n        ratingCount.textContent = `${input.value}.0`;\n      }\n    };\n    input.addEventListener('change', changeListener);\n    ratingChangeListeners.push({ input, listener: changeListener });\n  });\n\n  // Attach exercise modal click listener\n  exerciseModalClickListener = event => {\n    if (event.target.closest('.exercise-modal_close')) {\n      exerciseModal.classList.remove('is-active');\n    }\n    if (event.target.closest('.modal-rating_btn')) {\n      // Store the exercise ID before opening rating modal\n      const modalContent = document.querySelector('.exercise-modal_content');\n      const favoriteBtn = modalContent.querySelector('.modal-favorites_btn');\n      currentExerciseId = favoriteBtn ? favoriteBtn.id : null;\n\n      console.log(\n        '[DEBUG] Opening rating modal - currentExerciseId:',\n        currentExerciseId\n      );\n\n      // Reset form and rating count when modal opens\n      ratingForm.reset();\n      if (ratingCount) {\n        ratingCount.textContent = '0.0';\n      }\n\n      // Check form state before opening rating modal\n      const emailInput = document.querySelector('.form-input');\n      const commentInput = document.querySelector('.form-textarea');\n      const ratingInput = document.querySelector(\n        'input[name=\"rating\"]:checked'\n      );\n      console.log(\n        '[DEBUG] Before opening rating modal - email:',\n        emailInput?.value,\n        'comment:',\n        commentInput?.value,\n        'rating:',\n        ratingInput?.value\n      );\n\n      exerciseModal.classList.remove('is-active');\n      setTimeout(() => {\n        ratingModal.classList.add('is-active');\n        // Check form state after opening rating modal\n        console.log(\n          '[DEBUG] After opening rating modal - email:',\n          emailInput?.value,\n          'comment:',\n          commentInput?.value,\n          'rating:',\n          ratingInput?.value\n        );\n      }, 250);\n    }\n    if (event.target === exerciseModal) {\n      exerciseModal.classList.remove('is-active');\n    }\n  };\n  if (exerciseModal) {\n    exerciseModal.addEventListener('click', exerciseModalClickListener);\n  }\n\n  // Attach rating modal click listener\n  ratingModalClickListener = event => {\n    if (\n      event.target.closest('.rating-modal_close') ||\n      event.target === ratingModal\n    ) {\n      console.log(\n        '[DEBUG] Closing rating modal - currentExerciseId:',\n        currentExerciseId\n      );\n\n      // Check form state before closing\n      const emailInput = document.querySelector('.form-input');\n      const commentInput = document.querySelector('.form-textarea');\n      const ratingInput = document.querySelector(\n        'input[name=\"rating\"]:checked'\n      );\n      console.log(\n        '[DEBUG] Before closing rating modal - email:',\n        emailInput?.value,\n        'comment:',\n        commentInput?.value,\n        'rating:',\n        ratingInput?.value\n      );\n\n      // Reset form and rating count when modal closes\n      ratingForm.reset();\n      ratingModal.classList.remove('is-active');\n      if (ratingCount) {\n        ratingCount.textContent = '0.0';\n      }\n      let modal_Id = currentExerciseId;\n      currentExerciseId = null; // Reset exercise ID\n      // Reset rating count display\n      setTimeout(() => {\n        openExerciseModal(modal_Id);\n        // Check form state after closing\n        console.log(\n          '[DEBUG] After closing rating modal - email:',\n          emailInput?.value,\n          'comment:',\n          commentInput?.value,\n          'rating:',\n          ratingInput?.value\n        );\n      }, 250);\n    }\n  };\n  if (ratingModal) {\n    ratingModal.addEventListener('click', ratingModalClickListener);\n  }\n\n  // Attach document keydown listener\n  documentKeydownListener = e => {\n    if (e.key === 'Escape') {\n      console.log('[DEBUG] Escape key pressed');\n\n      // Check form state before closing\n      const emailInput = document.querySelector('.form-input');\n      const commentInput = document.querySelector('.form-textarea');\n      const ratingInput = document.querySelector(\n        'input[name=\"rating\"]:checked'\n      );\n      console.log(\n        '[DEBUG] Escape - email:',\n        emailInput?.value,\n        'comment:',\n        commentInput?.value,\n        'rating:',\n        ratingInput?.value\n      );\n\n      // Reset form and rating count when Escape is pressed\n      ratingForm.reset();\n      exerciseModal?.classList.remove('is-active');\n      ratingModal?.classList.remove('is-active');\n      currentExerciseId = null;\n      // Reset rating count display\n      if (ratingCount) {\n        ratingCount.textContent = '0.0';\n      }\n\n      // Check form state after closing\n      console.log(\n        '[DEBUG] Escape after - email:',\n        emailInput?.value,\n        'comment:',\n        commentInput?.value,\n        'rating:',\n        ratingInput?.value\n      );\n    }\n  };\n  document.addEventListener('keydown', documentKeydownListener);\n}\n"],"names":["formSubmitListener","exerciseModalClickListener","ratingModalClickListener","documentKeydownListener","ratingChangeListeners","currentExerciseId","initModalHandler","exerciseModal","ratingModal","ratingForm","ratingCount","input","listener","event","emailInput","commentInput","ratingInput","email","review","rating","rate","response","error","changeListener","favoriteBtn","modal_Id","openExerciseModal","e"],"mappings":"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"}